# 研究者文档：05 - MCP 集成与应用：赋能自主 Agent

本文档将介绍 Kosmos 的一个高级应用场景：通过**主控程序 (Master Control Program, MCP)** 与通用自主 Agent (以 Gemini CLI 为例) 集成，赋能 Agent 完成需要深度领域知识的复杂、多步骤任务。

我们将以 `@examples/assessment_agent` 中的数据安全评估任务为例，剖析其工作原理。

## 1. 概念：什么是 MCP 集成？

Kosmos 本身是一个强大的知识管理和检索引擎。然而，当它通过 MCP 与一个通用的、具备推理能力的 Agent 相结合时，其价值将得到指数级提升。

-   **通用 Agent**: 如 Gemini CLI，拥有强大的自然语言理解、推理和工具使用能力，但缺乏特定领域的深入知识。
-   **Kosmos 知识库**: 存储了海量的、专业的领域知识（例如，数据安全控制条例、公司内部文档），但自身不执行任务。
-   **MCP**: 扮演着“协调器”和“操作系统”的角色。它为 Agent 提供一个工作环境，将 Agent 的通用智能与 Kosmos 的专业知识连接起来，使其能够自主地拆解任务、查询知识、形成判断并最终完成目标。

这种集成将 Kosmos 从一个被动的知识库，转变为一个可供 Agent 主动查询和利用的**动态知识源**。

## 2. 案例研究：自动化数据安全评估

在 `@examples/assessment_agent` 示例中，我们的目标是让 Agent 自动完成一项数据安全评估任务。

### 任务组件：

-   **任务定义 (SOP)**: `data_security_assessment_sop.md` 文件用自然语言清晰地描述了 Agent 的任务、目标、知识源、以及最终报告的格式。
-   **评估标准 (Controls)**: `controls.jsonl` 文件包含了所有需要评估的具体控制项。在 Kosmos 中，这整个文件被摄入为一个知识库。
-   **证据 (Evidence)**: 相关的证据材料（如制度文档、会议纪要、人员名单）已被预先摄入到 Kosmos 的一个特定知识库中。SOP 文件明确告知了 Agent 该知识库的 ID。
-   **最终产物 (Artifact)**: `assessment_report.jsonl` 是 Agent 需要生成的最终评估报告。
-   **思考轨迹 (Trajectory)**: `trajectory.json` 完整记录了 Agent 从接收任务到完成报告的每一步思考、每一次工具调用（特别是对 Kosmos 的搜索）以及观察到的结果。

### 工作流程：

```mermaid
graph TD
    A[1. Agent 接收 SOP] --> B{2. 拆解任务};
    B --> C[3. 读取首个控制项<br>e.g., '7.2.1.a'];
    C --> D{4. 构造语义查询};
    D -- "数据处理目的的合理性" --> E[5. 查询 Kosmos];
    E --> F[6. 获取相关证据<br>(Chunks)];
    F --> G{7. 形成判断};
    G -- "符合" / "不符合" --> H[8. 撰写单项报告];
    H --> I{9. 是否所有控制项<br>都已评估?};
    I -- No --> C;
    I -- Yes --> J[10. 任务完成];

    subgraph "Agent (Gemini CLI)"
        A; B; C; D; G; H; I; J;
    end

    subgraph "Kosmos"
        E; F;
    end
```

1.  **任务理解**: Agent 首先阅读 SOP (`data_security_assessment_sop.md`)，理解其任务目标、评估范围 (`controls.jsonl`) 和知识来源（Kosmos 知识库）。
2.  **任务分解**: Agent 按照 `controls.jsonl` 的顺序，逐一处理每个控制项。
3.  **查询与证据收集**: 对于每个控制项，Agent 会将其要求（例如，“评估数据处理目的是否合理、正当”）转化为一个或多个**自然语言语义查询**。
4.  **Kosmos 赋能**: 这是最关键的一步。Agent **无需**下载和阅读知识库中的所有原始文档。它将语义查询发送给 Kosmos。Kosmos 的语义搜索管线会精准地返回与查询意图最相关的知识块 (Chunks)。
5.  **判断与报告**: Agent 分析 Kosmos 返回的少量、高相关的证据，并根据 SOP 的要求形成判断（例如，“符合”、“不符合”）。然后，它将该判断、评论和引用的证据 Chunk ID 写入到最终的报告文件 `assessment_report.jsonl` 中。
6.  **循环**: Agent 重复步骤 3-5，直到 `controls.jsonl` 中的所有控制项都被评估完毕。

## 3. 轨迹分析 (`trajectory.json`)

通过分析 `trajectory.json`，我们可以清晰地看到 Agent 的“思考-行动-观察”循环：

-   **思考 (Thought)**: Agent 在 `parts` 中输出它的决���过程。例如：“好的，我明白了。我将开始执行...首先，我将从控制项 `7.2.1.a` 开始...我将在知识库中搜索相关证据...”。
-   **行动 (Action)**: Agent 执行一个工具调用，最典型的就是对 Kosmos 的搜索。这在轨迹中表现为一个对搜索工具的函数调用。
-   **观察 (Observation)**: Agent 接收到工具调用的返回结果，即 Kosmos 的搜索结果。

这个循环不断重复，展示了 Agent 如何利用 Kosmos 作为其“外部知识大脑”，逐步、稳健地完成复杂的评估任务。

## 4. 结论

MCP 集成范式展示了 Kosmos 的核心价值：它不仅仅是一个知识存储系统，更是一个**赋能智能体 (Agent-Enablement) 系统**。通过提供高质量、上下文感知的语义搜索，Kosmos 极大地降低了通用 Agent 执行专业领域任务的门槛，使其能够：

-   **避免信息过载**: Agent 无需处理海量原始文档，只需聚焦于 Kosmos 返回的高相关性知识片段。
-   **提升准确性**: 语义搜索确保了 Agent 获取的证据与任务直接相关，从而做出更准确的判断。
-   **增强任务稳定性**: 有了可靠的知识源，Agent 的任务执行路径变得更加稳定和可预测。

这种集成模式为实现更复杂的、需要深度知识参与的自动化工作流（如自动化科学研究、法律文书分析、智能投研等）提供了坚实的基础。
