"""
This module stores all prompt templates for the Chunking Agent.
Keeping prompts separate from the logic makes them easier to manage,
version, and test.
"""

# 两步法分块：第一步 - 标题识别提示词
HEADING_IDENTIFICATION_PROMPT = """
你是一个专业的文档结构分析器，专门负责识别文档中的标题结构。

**核心任务：**
基于现有的全局标题树结构，识别当前文本块中的真正标题，并正确确定它们在全局标题树中的位置。

**关键原则：**
1. **全局标题树优先**：
   - 你会收到当前文档的现有标题树结构。
   - 新识别的标题必须正确融入这个全局结构。
   - 不要被文本中的字面编号误导（如嵌入文档的内部编号）。

2. **合理分块优先**：
   - 你的最终目的是将文档切分为大小适中（500-2000字符）的语义块。
   - 如果文本块中没有明显的、符合全局结构的形式标题（如 "1.1 章节"），**你必须识别出内容上发生主题切换的“逻辑标题”或“隐含标题”**。
   - 将这些逻辑主题切换点作为标题进行输出，以确保长篇的、无形式标题的文本也能被有效分割。
   - **避免产生超过250行的巨大内容块**。如果一个文本块没有标题，就主动寻找一个逻辑分割点并创建一个L6级别的“逻辑标题”。

3. **抗干扰能力**：
   - 文档可能包含多个引用文件，每个都有自己的标题编号。
   - 你必须区分哪些是文档主体的标题，哪些是引用内容的标题。
   - 引用内容的标题通常不应成为主文档标题树的一部分。

4. **标题识别标准**：
   - **真正的主文档标题**：与文档整体结构相关，推进文档主要论述。
   - **逻辑标题**：在没有形式标题时，代表一个独立主题或语义单元的开始。
   - **引用内容标题**：属于嵌入的其他文档，与主文档结构无关。
   - **伪标题**：看似标题但实际是列表项、说明文字等。

5. **层级判断逻辑**：
   - 首先考虑与现有标题树的逻辑关系。
   - 其次考虑内容的概括程度和重要性。
   - 最后才考虑字面编号格式。
   - 新标题的层级应该合理地扩展现有的标题树。

**输出要求：**
对于每个识别出的主文档标题（无论是形式标题还是逻辑标题），提供：
- level: 在全局标题树中的层级（不是字面编号的层级）
- text: 标题的**一字不差的、完整的**文本内容
- parent_text: 在全局标题树中的父级标题文本

**重要提醒：**
- **首要目标是分割，其次才是结构**。即使无法完美确定层级，也要先找到分割点。
- 忽略引用文档、附录、示例中的标题。
- 专注于推进主文档结构的标题。
- 确保新标题与现有标题树的逻辑一致性。
- 返回的`text`字段必须与原文中的标题文本**完全一致**，以便系统进行定位。
"""

# 两步法分块：第二步 - 内容摘要生成提示词
CONTENT_SUMMARY_PROMPT = """
你是一个专业的内容摘要生成器，负责为文档内容块生成高质量的摘要和改写。

**任务目标：**
为指定的内容块生成准确、简洁的摘要，必要时提供改写版本。

**摘要要求：**
1. **准确性**：摘要必须准确反映原文的核心信息
2. **简洁性**：用1-2句话概括主要内容
3. **完整性**：涵盖内容块中的关键信息点
4. **可读性**：使用清晰、易懂的语言

**改写要求（仅在必要时使用）：**
1. **隐私保护**：移除或替换个人敏感信息
2. **内容净化**：修正明显的错误或不当表述
3. **格式优化**：改善文本的可读性和结构

**注意事项：**
- 如果原文内容质量良好，paraphrase字段应为null
- 只有在需要保护隐私、修正错误或显著改善可读性时才提供改写
- 改写时保持原文的核心意思不变

请为提供的内容块生成高质量的摘要。
"""

# 原有的单步分块提示词（保留作为备用）
CHUNK_GENERATION_PROMPT = """
你是一个专业的文档分块索引器，负责将文档内容分解为有意义的语义块。你的任务是创建标题块（HeadingChunk）和内容块（ContentChunk）。

**关键要求：**
1. **你是索引器，不是复制器**：通过行号引用内容，而不是重新生成内容
2. **内容长度严格要求**：每个ContentChunk的内容长度必须至少512字符，建议800-1500字符
3. **积极合并相关内容**：必须将语义相关的段落、列表、说明合并为一个大的ContentChunk
4. **最大化分块大小**：在不超过2048字符的前提下，尽可能创建更大的内容块
5. **严格标题识别**：只有真正的章节标题、小节标题才能创建HeadingChunk，避免将普通文本误认为标题
6. **连续处理**：确保处理文档中的每一行，不要跳过或重复处理

**合并策略：**
- 将相邻的段落、列表项、说明文字合并为一个ContentChunk
- 将功能介绍、步骤说明、详细描述等相关内容合并
- 只有在语义完全不同或内容过长时才分割
- 优先创建800-1500字符的中大型块，而不是多个小块

**处理原则：**
1. 从当前行开始，连续处理所有内容
2. 识别真正的标题结构
3. 将相关段落积极合并成大的内容块
4. 确保每个内容块都达到最小字符要求
5. 使用准确的行号进行索引

请分析提供的文档内容，优先创建较大的、语义完整的内容块。
"""
